<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="departMapper">
	<resultMap type="Department" id="departmentResultSet">
		<id property="annoNo" column="ANNO_NO"/>
		<result property="refDepart" column="REF_DEPART"/>
		<result property="annoWR" column="ANNO_WR"/>
		<result property="writerName" column="EMP_NAME"/>
		<result property="writerJo" column="JOB_NAME"/>
		<result property="annoTitle" column="ANNO_TITLE"/>
		<result property="annoContent" column="ANNO_CONTENT"/>
		<result property="accessReply" column="ACCESS_REPLY"/>	
		<result property="annoDate" column="ANNO_DATE"/>	
		<result property="annoChangeDate" column="ANNO_DATE2"/>
		<result property="status" column="STATUS"/>
		<result property="count" column="COUNT"/>	
		<result property="attachStatus" column="ATTACH_STATUS"/>	
		<result property="nextNo" column="NEXTNO"/>	
		<result property="prevNo" column="PREVNO"/>	
	</resultMap>
	<resultMap type="Attachment" id="attachmentResultSet">
		<id property="fileNo" column="FILE_NO"/>
		<result property="refListCatNo" column="REF_LIST_CAT_NO"/>
		<result property="largeCat" column="LARGE_CAT"/>
		<result property="originName" column="ORIGIN_NAME"/>
		<result property="changeName" column="CHANGE_NAME"/>
	</resultMap>
	<resultMap type="DepartmentReply" id="departmentReplyResultSet">
		<id property="replyNo" column="AR_NO"/>
		<result property="refDepartNo" column="ANNO_NO"/>
		<result property="replyWriter" column="REPLY_WRITER"/>
		<result property="writerName" column="EMP_NAME"/>
		<result property="writerJo" column="JOB_NAME"/>
		<result property="replyTitle" column="REPLY_TITLE"/>
		<result property="createDate" column="AR_DATE"/>
		<result property="wrDate" column="WR_DATE"/>
		<result property="status" column="AR_STATUS"/>
	</resultMap>
	<resultMap type="Project" id="projectResultSet">
		<id property="proNo" column="PRO_NO"/>
		<result property="proWriter" column="PRO_WRITER"/>
		<result property="proDepart" column="PRO_DEPART"/>
		<result property="proTitle" column="PRO_TITLE"/>
		<result property="proDate" column="PRO_DATE"/>
		<result property="proStatus" column="PRO_STATUS"/>
	</resultMap>
	
	<insert id="insertAnnoDepart" parameterType="Department">
		INSERT INTO ANNOUNCE_DEPART
		VALUES
		(SEQ_ANNO.NEXTVAL, #{refDepart}, #{annoWR}, #{annoTitle}, #{annoContent}, #{accessReply}, SYSDATE, DEFAULT, DEFAULT, #{attachStatus})
	</insert>
	<insert id="insertAnnoDepartAttach" parameterType="Attachment">
		INSERT INTO ATTACHMENT
		VALUES
		(SEQ_ATTACH.NEXTVAL,#{refListCatNo},SEQ_ANNO.CURRVAL, #{originName}, #{changeName}, SYSDATE, DEFAULT)
	</insert>
	<select id="selectAnnoDepartList" parameterType="_int" resultMap="departmentResultSet">
		SELECT ANNO_NO, REF_DEPART,ANNO_WR, EMP_NAME, ANNO_TITLE, ACCESS_REPLY, ANNO_DATE, COUNT
		FROM ANNOUNCE_DEPART AD
		JOIN USER_INFO ON (ANNO_WR=EMP_NO)
		WHERE REF_DEPART = #{adno}
		AND AD.STATUS='Y'
	</select>
	<update id="increaseCount" parameterType="_int">
		UPDATE ANNOUNCE_DEPART
		SET COUNT = COUNT+1
		WHERE ANNO_NO =#{adno}
		AND STATUS='Y'
	</update>
	<select id="selectDepartmentAnno" parameterType="_int" resultMap="departmentResultSet">
		SELECT ANNO_NO, REF_DEPART, ANNO_WR, EMP_NAME, ANNO_TITLE, ANNO_CONTENT, ACCESS_REPLY, TO_CHAR(ANNO_DATE, 'YYYY/MM/DD HH24:MI:SS') AS ANNO_DATE2, COUNT, ATTACH_STATUS, JOB_NAME, LEAD(ANNO_NO) OVER(ORDER BY ANNO_NO) AS NEXTNO, LAG(ANNO_NO) OVER(ORDER BY ANNO_NO) PREVNO
		FROM ANNOUNCE_DEPART AD
		JOIN USER_INFO UI ON(ANNO_WR=EMP_NO)
		JOIN JOB_RANK_MANAGEMENT JR ON (UI.JOB_NO=JR.JOB_NO)
		WHERE ANNO_NO =#{adno}
		AND AD.STATUS='Y'
	</select>
	<select id="selectAttachmentAnno" parameterType="_int" resultMap="attachmentResultSet">
		SELECT FILE_NO, REF_LIST_CAT_NO, LARGE_CAT, ORIGIN_NAME, CHANGE_NAME
		FROM ATTACHMENT
		WHERE REF_LIST_CAT_NO = 60
		AND LARGE_CAT=#{adno}
		AND STATUS = 'Y'
	</select>
	<update id="deleteAnnoDepart" parameterType="_int">
		UPDATE ANNOUNCE_DEPART
		SET STATUS = 'N'
		WHERE ANNO_NO = #{adno}
		AND STATUS ='Y'
	</update>
	<update id="deleteAnnoDepartRef" parameterType="_int">
		UPDATE ATTACHMENT
		SET STATUS ='N'
		WHERE FILE_NO=#{rlcn}
		AND REF_LIST_CAT_NO=60
		AND STATUS='Y'
	</update>
	<update id="updateAnnoDepart" parameterType="Department">
		UPDATE ANNOUNCE_DEPART
		SET ANNO_TITLE =#{annoTitle}, ANNO_CONTENT=#{annoContent}, ACCESS_REPLY=#{accessReply}, ATTACH_STATUS=#{attachStatus}
		WHERE ANNO_NO = #{annoNo}
		AND STATUS='Y'
	</update>
	<update id="updateAnnoDepartAttach">
		UPDATE ATTACHMENT
		SET ORIGIN_NAME = #{originName}, CHANGE_NAME = #{changeName}
		WHERE FILE_NO=#{fileNo}
		AND STATUS ='Y'
	</update>
	<insert id="insertAnnoDepartreAttach" parameterType="Attachment">
		INSERT INTO ATTACHMENT
		VALUES
		(SEQ_ATTACH.NEXTVAL,#{refListCatNo},#{largeCat}, #{originName}, #{changeName}, SYSDATE, DEFAULT)
	</insert>
	<insert id="insertAnnoReply" parameterType="DepartmentReply">
		INSERT INTO ANNO_REPLY
		VALUES
		(SEQ_REPLY.NEXTVAL, #{refDepartNo}, #{replyWriter}, #{replyTitle}, SYSDATE, DEFAULT)
	</insert>
	<select id="selectAnnoReplyList" parameterType="_int" resultMap="departmentReplyResultSet">
		SELECT AR_NO, ANNO_NO, REPLY_WRITER, EMP_NAME, REPLY_TITLE, TO_CHAR(AR_DATE, 'YYYY/MM/DD HH24:MI:SS') AS WR_DATE, AR_STATUS, JOB_NAME
		FROM ANNO_REPLY
		JOIN USER_INFO UI ON(REPLY_WRITER=EMP_NO)
        JOIN JOB_RANK_MANAGEMENT JR ON (UI.JOB_NO=JR.JOB_NO)
		WHERE ANNO_NO = #{adno}
		AND AR_STATUS='Y'
	</select>
	<update id="deleteAnnoDepartReply">
		UPDATE ANNO_REPLY
		SET AR_STATUS='N'
		WHERE AR_NO = #{adro}
		AND AR_STATUS='Y'
	</update>
	<insert id="insertDPSimple" parameterType="Project">
		INSERT INTO PROJECT
		VALUES
		(SEQ_ANPRO.NEXTVAL, #{proWriter}, #{proDepart}, #{proTitle}, SYSDATE, DEFAULT)
	</insert>
	<insert id="insertclass">
		INSERT INTO PRO_CLASS
		VALUES 
		(SEQ_PRCL.NEXTVAL, SEQ_ANPRO.CURRVAL, DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT)
	</insert>
	<insert id="insertInclude" parameterType="Project">
		INSERT INTO PRO_WATCHER
		VALUES
		(SEQ_PROWAT.NEXTVAL, SEQ_ANPRO.CURRVAL, #{proWriter},DEFAULT)
	</insert>
	<select id="selectProjectList" parameterType="_int" resultMap="projectResultSet">
		SELECT * 
		FROM PROJECT
		WHERE PRO_NO IN(SELECT REF_PRO
		                FROM PRO_WATCHER
		                WHERE PW_ATTEN =#{emno})
	</select>
</mapper>