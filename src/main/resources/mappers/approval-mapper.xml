<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="aprvMapper">
	
	<!-- 결재 완료 문서 -->
	<resultMap type="AprvDoc" id="aprvComRSet">
		<result property="docNo" column="DOC_NO"/>
		<result property="docType" column="DOC_TYPE"/>
		<result property="docTitle" column="DOC_TITLE"/>
		<result property="drafter" column="DRAFTER"/>
		<result property="comDate" column="PRO_DATE"/>
	</resultMap>
	
	<!-- 결재 완료 문서 총 개수 -->
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*)
		FROM V_COMPLETE_DOC
	</select>
	
	<!-- 결재 완료 문서 리스트 -->
	<select id="selectList" resultMap="aprvComRSet">
		SELECT *
		FROM V_COMPLETE_DOC
	</select>
	
	
	<!-- 문서 등록 -->
	
	<!-- 결재선 조회 -->
	<select id="selectApprover" parameterType="string" resultType="Member">
		SELECT
			A.EMP_NO,
		    A.EMP_NAME,
		    B.JOB_NAME
		FROM USER_INFO A
		JOIN JOB_RANK_MANAGEMENT B ON A.JOB_NO = B.JOB_NO
		WHERE 1=1
		AND A.DEPARTMENT_NO = #{deptNo}
		AND A.JOB_NO IN (4, 7)
		ORDER BY B.JOB_NO
	</select>
	
	<!-- 결재 문서 등록 -->
	<insert id="insertAprvDoc" parameterType="AprvDoc">
		INSERT INTO APRV_DOCUMENT VALUES
		(SEQ_DOC_NO.NEXTVAL, #{docType}, #{docTitle}, #{drafter}, #{firstAprv}, #{secondAprv}, DEFAULT, DEFAULT)
	</insert>
	
	<!-- 결재 기록 등록 -->
	<insert id="insertAprvHistory" parameterType="AprvHistory">
		INSERT INTO APRV_HISTORY VALUES
		(SEQ_APRV_HISTORY.NEXTVAL, SEQ_DOC_NO.CURRVAL, #{approver}, #{approverJob}, #{aprvPro}, DEFAULT)
	</insert>
	
	<!-- 휴가 신청서 등록 -->
	<insert id="insertLeaveApp" parameterType="LeaveForm">
		INSERT INTO LEAVE_APP VALUES
		(SEQ_LEAVE_APP.NEXTVAL, SEQ_DOC_NO.CURRVAL, #{docTypeNo}, #{drafter}, #{drafterDept}, DEFAULT, #{vacType}, #{startDate}, #{endDate}, #{vacUseDays}, #{vacReason})
	</insert>

</mapper>
