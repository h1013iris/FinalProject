<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="aprvMapper">
	
	<!-- 결재 완료 문서 -->
	<resultMap type="AprvDoc" id="aprvComRSet">
		<result property="docNo" column="DOC_NO"/>
		<result property="docType" column="DOC_TYPE"/>
		<result property="docTitle" column="DOC_TITLE"/>
		<result property="drafter" column="DRAFTER"/>
		<result property="comDate" column="PRO_DATE"/>
	</resultMap>
	
	<!-- 결재 완료 문서 총 개수 -->
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*)
		FROM V_COMPLETE_DOC
	</select>
	
	<!-- 결재 완료 문서 리스트 -->
	<select id="selectList" resultMap="aprvComRSet">
		SELECT *
		FROM V_COMPLETE_DOC
	</select>
	
	
	<!-- 문서 등록 -->
	
	<!-- 결재선 조회 -->
	<select id="selectApprover" parameterType="string" resultType="Member">
		SELECT
			A.EMP_NO,
		    A.EMP_NAME,
		    B.JOB_NAME
		FROM USER_INFO A
		JOIN JOB_RANK_MANAGEMENT B ON A.JOB_NO = B.JOB_NO
		WHERE 1=1
		AND A.DEPARTMENT_NO = #{deptNo}
		AND A.JOB_NO IN (4, 7)
		ORDER BY B.JOB_NO
	</select>
	
	<select id="selectDeptName" parameterType="string" resultType="string">
		SELECT DEPARTMENT_TITLE
		FROM DEPARTMENT_MANAGEMENT
		WHERE DEPARTMENT_NO = #{deptNo}
	</select>
	
	<!-- 결재 문서 등록 -->
	<insert id="insertAprvDoc" parameterType="AprvDoc">
		INSERT INTO APRV_DOCUMENT VALUES
		(SEQ_DOC_NO.CURRVAL, #{docType}, #{docTitle}, #{drafter}, #{firstAprv}, #{secondAprv}, DEFAULT, DEFAULT)
	</insert>
	
	<!-- 결재 기록 등록 -->
	<insert id="insertAprvHistory" parameterType="AprvHistory">
		INSERT INTO APRV_HISTORY VALUES
		(SEQ_APRV_HISTORY.NEXTVAL, SEQ_DOC_NO.CURRVAL, #{approver}, #{approverJob}, #{aprvPro}, DEFAULT)
	</insert>
	
	<!-- 휴가 신청서 등록 -->
	<insert id="insertLeaveApp" parameterType="LeaveForm">
		INSERT INTO LEAVE_APP VALUES
		(SEQ_LEAVE_APP.NEXTVAL, SEQ_DOC_NO.NEXTVAL, #{docTypeNo}, #{drafter}, #{drafterDept}, DEFAULT, #{vacType}, #{startDate}, #{endDate}, #{vacUseDays}, #{vacReason})
	</insert>
	
	<!-- 해당 날짜 근태 기록 조회 -->
	<select id="selectCmt" parameterType="AttendLog" resultType="AttendLog">
		SELECT
		    SUBSTR(TO_CHAR(ATTEND_TIME, 'YYYY/MM/DD HH24:MI:SS'), 12, 5) AS ATTEND_TIME,
		    SUBSTR(TO_CHAR(LEAVE_TIME, 'YYYY/MM/DD HH24:MI:SS'), 12, 5) AS LEAVE_TIME
		FROM ATTEND_LOG
		WHERE 1=1
		AND EMP_NO = #{empNo}
		AND ATTEND_DATE = TO_DATE(#{attendDate})
	</select>
	
	<!-- <insert id="insertCmtUpdateForm" parameterType="CmtUpdateForm">
		INSERT INTO CMT_UPDATE_APP VALUES
		()
	</insert> -->

</mapper>
